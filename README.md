# Keyboard Protector

Windows용 키보드 입력 모니터링 및 암호화 보안 도구입니다. 저수준 키보드 후크를 사용하여 시스템 전체의 키 입력을 감지하고 암호화하여 출력합니다.

## 🚀 주요 기능

- **키보드 입력 암호화**: 키보드 입력을 실시간으로 암호화하여 출력
- **전역 키보드 모니터링**: Windows 저수준 키보드 후크로 모든 키보드 입력 감지
- **안전한 종료**: ESC 키를 통한 안전한 프로그램 종료
- **실시간 모니터링**: 키 입력 감지 및 암호화된 로그 출력
- **관리자 권한 확인**: 실행 시 관리자 권한 상태 표시
- **강화된 에러 처리**: 상세한 에러 메시지 및 안전한 종료

## 📋 시스템 요구사항

- **운영체제**: Windows XP 이상 (모든 버전)
- **권한**: 관리자 권한 권장
- **아키텍처**: 32비트 빌드 (WOW64로 64비트 Windows에서도 자동 실행)

## 🔧 프로젝트 구조

```
cursor-keyprotect/
├── src/
│   ├── main.c              # 메인 진입점
│   ├── keyboard_protector.c # 후크 구현
│   └── crypto_keycode.c    # 키 코드 암호화 기능
├── include/
│   └── keyboard_protector.h # 헤더 파일
├── bin/                    # 실행 파일 (빌드 후 생성)
├── obj/                    # 오브젝트 파일 (빌드 후 생성)
├── Makefile               # 빌드 설정
└── README.md              # 이 파일
```

## ⚡ 빠른 시작

### 1. 빌드

```cmd
make
```

이 명령은 32비트 빌드를 생성합니다. 32비트 빌드는 WOW64를 통해 모든 Windows 버전에서 실행됩니다.

### 2. 실행

```cmd
bin\keyboard_protector.exe
```

### 3. 종료

ESC 키를 눌러 프로그램을 종료합니다.

## 🛠️ 빌드 방법

### 기본 빌드 (권장)

```cmd
make
```

이 명령은 32비트 모드를 기본으로 사용하여 Windows XP부터 최신 버전까지 모든 Windows에서 작동하는 실행 파일을 생성합니다.

### 정리 후 다시 빌드

```cmd
make clean
make rebuild
```

### Make 명령어

```cmd
make          # 32비트 빌드 (모든 Windows 지원)
make clean    # 빌드 파일 정리
make rebuild  # 정리 후 다시 빌드
make debug    # 디버그 모드로 빌드
make release  # 릴리스 모드로 빌드
make run      # 빌드 후 실행
make help     # 도움말 표시
```

## 📦 빌드 요구사항

- **컴파일러**: MinGW-w64 또는 GCC
- **Make**: Make 도구
- **라이브러리**: 
  - `user32` (Windows GUI)
  - `advapi32` (관리자 권한 확인)

### MinGW-w64 설치

**Chocolatey 사용:**
```cmd
choco install mingw make -y
```

**수동 설치:**
- https://www.mingw-w64.org/downloads/
- 또는 https://winlibs.com/

## ⚠️ 주의사항

### 보안

- 이 프로그램은 **관리자 권한**이 필요할 수 있습니다.
- 키보드 입력을 감지하고 암호화하지만 차단하지는 않습니다.
- **ESC 키만**이 프로그램 종료를 위해 허용됩니다.
- 보안 도구 목적으로만 사용하세요.

### 사용 전 확인

```cmd
# 테스트 전 가상머신 사용 권장
# 또는 작업 관리자로 강제 종료하는 방법 알고 있기

# 강제 종료 방법
taskkill /F /IM keyboard_protector.exe
```

## 🐛 알려진 문제 및 해결책

### 1. "관리자 권한 필요" 오류

**증상:** 후크 설치 실패

**해결:**
- 관리자 권한으로 실행
- 또는 가상머신에서 테스트

### 2. 빌드 호환성

**현재 구성:** 기본적으로 32비트 빌드를 생성합니다.

**장점:**
- Windows XP부터 최신 Windows까지 모두 지원
- WOW64를 통해 64비트 Windows에서도 자동 실행
- 최대 호환성 보장

**빌드:**
```cmd
make
```

## 🔍 동작 원리

1. **저수준 키보드 후크 설치** (`WH_KEYBOARD_LL`)
2. **모든 키 입력 감지**
3. **키 코드 암호화**: 각 키 입력을 솔트와 고정 키를 사용하여 암호화
4. **암호화된 정보 출력**: 원본 키 코드, 솔트, 암호화된 키 코드를 출력
5. **키 입력 전달**: 키 입력을 차단하지 않고 정상적으로 전달
6. **ESC 키 처리**: ESC 키 입력 시 종료 신호 전송
7. **메시지 루프 실행** (`GetMessage`)
8. **종료 시 후크 해제**

## 🎯 주요 개선사항

### ESC 키 종료 기능

ESC 키 입력 시 `PostQuitMessage(0)`을 호출하여 메시지 루프를 정상 종료합니다.

### 에러 처리 강화

- `GetMessage()` 반환값 검사 (-1 에러 처리)
- 시스템 에러 코드 출력
- 적절한 Exit code 반환

### 관리자 권한 확인

Windows Vista 이상에서 자동으로 관리자 권한을 확인하고 표시합니다.

### Windows XP 호환성

`_WIN32_WINNT=0x0501` 설정을 통해 Windows XP와의 호환성을 보장합니다. 32비트 빌드로 생성되어 모든 Windows 버전에서 실행 가능합니다.

### 키 코드 암호화 기능

- **XOR 기반 암호화**: 키 코드와 솔트를 사용한 XOR 암호화
- **솔트 기반 보안**: 각 키 입력마다 다른 솔트(시간 기반) 사용
- **암호화/복호화 함수**: `encrypt_keycode_with_salt()`, `decrypt_keycode_with_salt()` 제공

### Doxygen 주석 추가

모든 함수와 전역 변수에 Doxygen 스타일의 주석을 추가하여 코드 문서화를 개선했습니다.

## 📚 기술 스택

- **언어**: C99
- **플랫폼**: Windows API
- **후크 타입**: `WH_KEYBOARD_LL` (저수준 키보드 후크)
- **컴파일러**: GCC (MinGW-w64)
- **타겟**: 32비트 (모든 Windows 버전 호환)

## 🤝 기여하기

1. 이 저장소를 포크합니다
2. 새 기능 브랜치를 생성합니다 (`git checkout -b feature/AmazingFeature`)
3. 변경사항을 커밋합니다 (`git commit -m 'Add some AmazingFeature'`)
4. 브랜치에 푸시합니다 (`git push origin feature/AmazingFeature`)
5. Pull Request를 생성합니다

## 📝 라이선스

이 프로젝트는 교육 및 보안 연구 목적으로 제작되었습니다.

**주의:** 상업적 사용이나 악의적인 목적으로 사용하지 마세요.

## 📞 문의

프로젝트에 대한 질문이나 제안사항이 있으시면 이슈를 생성해주세요.

---

## 📖 추가 정보

### 빌드 확인

```cmd
# 빌드 정보 확인
dumpbin /headers bin\keyboard_protector.exe | findstr machine
```

### 실행 시 출력 예시

```
[성공] 키보드 보안 툴이 실행되었습니다. 모든 키 입력이 암호화되어 출력됩니다.
[정보] 관리자 권한으로 실행 중입니다.
---------------------------------------------------------
Esc 키를 눌러 종료하십시오.

[키 감지] 원본 KeyCode: 65 | 솔트: 12345678 | 암호화된 KeyCode: 12345619
[키 감지] 원본 KeyCode: 66 | 솔트: 12345679 | 암호화된 KeyCode: 12345621

[알림] Esc 키가 눌렸습니다. 후크를 해제하고 종료합니다.

[종료] 키보드 보안 툴이 정상적으로 종료되었습니다.
```

### 지원되는 Windows 버전

| OS | 지원 여부 |
|----|----------|
| Windows XP | ✅ (WOW64 없음) |
| Windows Vista | ✅ (WOW64 포함) |
| Windows 7 | ✅ (WOW64 포함) |
| Windows 8/10/11 | ✅ (WOW64 포함) |

**참고:** 32비트 빌드는 64비트 Windows에서 WOW64를 통해 자동으로 실행됩니다.
